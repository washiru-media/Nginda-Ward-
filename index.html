<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nginda Ward Elite Political System</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{margin:0;font-family:'Segoe UI',sans-serif;background:#111;color:#fff;}
header{background:linear-gradient(90deg,#000,#1a1a1a,#000);padding:25px;text-align:center;border-bottom:3px solid gold;}
header h2{margin:0;color:gold;}
nav{display:flex;flex-wrap:wrap;justify-content:center;background:#000;border-bottom:2px solid gold;}
nav button{background:#222;border:2px solid gold;color:gold;padding:12px 20px;margin:5px;border-radius:10px;cursor:pointer;font-weight:bold;}
nav button:hover, nav button.activeTab{background:gold;color:#000;}
section{display:none;padding:25px;}
.active{display:block;}
.card{background:#1a1a1a;padding:25px;margin:15px 0;border-radius:12px;border:1px solid gold;}
input,select,textarea{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid gold;background:#000;color:white;}
button{padding:10px 14px;border:none;border-radius:6px;cursor:pointer;font-weight:bold;}
.primary{background:gold;color:black;}
.green{background:#0f5132;color:white;}
.red{background:#8b0000;color:white;}
footer{text-align:center;padding:15px;background:#000;border-top:2px solid gold;color:gold;}
canvas{background:#fff;border-radius:10px;padding:10px;}
.voteBtn.voted{background:#0f5132;color:white;cursor:default;}
.news-item,.career-item{background:#222;padding:10px;margin:8px 0;border-radius:6px;}
#exitModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);color:#fff;justify-content:center;align-items:center;z-index:9999;}
#exitModal .modal-content{background:#1a1a1a;padding:25px;border-radius:12px;border:2px solid gold;text-align:center;max-width:400px;}
</style>
</head>
<body>

<header>
<h2>Nginda Ward Elite Campaign Command Center</h2>
<p>Managed by WA Shirú Media | Contact 0724 253 280</p>
</header>

<nav>
<button onclick="showTab('home')" id="tabHome">Home</button>
<button onclick="showTab('dashboard')" id="tabDashboard">Dashboard</button>
<button onclick="showTab('vote')" id="tabVote">Vote</button>
<button onclick="showTab('poll')" id="tabPoll">Poll</button>
<button onclick="showTab('donate')" id="tabDonate">M-Pesa Support</button>
<button onclick="showTab('careers')" id="tabCareers">Careers</button>
<button onclick="showTab('news')" id="tabNews">News</button>
<button onclick="showTab('admin')" id="tabAdmin">Admin</button>
</nav>

<section id="home" class="active">
<div class="card">
<h3>Welcome to Nginda Ward Digital Leadership Platform</h3>
<p>Transparency, accountability and real-time leadership participation.</p>
</div>
</section>

<section id="dashboard">
<div class="card">
<h3>Live Political Analytics</h3>
<p id="totalVotes">Total Votes: 0</p>
<p id="pollStats">Poll Responses: 0</p>
<canvas id="voteChart"></canvas><br><br>
<canvas id="pollChart"></canvas>
<div id="villageStats"></div>
</div>
</section>

<section id="vote">
<div class="card">
<h3>Cast Your Leadership Vote</h3>
<select id="villageSelect">
<option value="">Select Your Village</option>
<option>Gathera</option>
<option>Itaaga</option>
<option>Nyagachugu</option>
<option>Irembu</option>
<option>Ikundu</option>
<option>Nginda</option>
<option>Ihigaini</option>
<option>Gakoigo</option>
<option>Mjini</option>
<option>Maragua Primary</option>
<option>Gathera ACC</option>
</select>
<div id="candidateList"></div>
</div>
</section>

<section id="poll">
<div class="card">
<h3>Opinion Poll</h3>
<button class="primary" onclick="castPoll('Yes')">Yes</button>
<button class="primary" onclick="castPoll('No')">No</button>
<p id="pollResults"></p>
</div>
</section>

<section id="donate">
<div class="card">
<h3>M-Pesa Support</h3>
<p><strong>Till:</strong> 5827051</p>
<p><strong>Phone:</strong> 0724253280</p>
<button class="primary" onclick="window.open('https://wa.me/254724253280')">Support via WhatsApp</button>
</div>
</section>

<section id="careers">
<div class="card">
<h3>Careers</h3>
<div id="careerList"></div>
</div>
</section>

<section id="news">
<div class="card">
<h3>Latest News</h3>
<div id="newsList"></div>
</div>
</section>

<section id="admin">
<div class="card">
<h3>Admin Login</h3>
<input type="email" id="adminEmail" placeholder="Email">
<input type="password" id="adminPassword" placeholder="Password">
<button class="primary" onclick="login()">Login</button>
<button class="red" onclick="logout()">Logout</button>

<div id="adminPanel" style="display:none;">
<hr>
<h4>Add Candidate</h4>
<input type="text" id="candidateName" placeholder="Candidate Name">
<button class="green" onclick="addCandidate()">Add Candidate</button>
</div>
</div>
</section>

<footer>© 2026 Nginda Ward | WA SHIRU MEDIA HUB</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCJsFgxc258DXcLstmavixRsxpI-11tf8M",
  authDomain: "ngindawardsystem.firebaseapp.com",
  projectId: "ngindawardsystem",
  storageBucket: "ngindawardsystem.appspot.com",
  messagingSenderId: "384741290542",
  appId: "1:384741290542:web:f1e8b507d71c5570d6a5bf"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.showTab = id => {
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};

function getDeviceId(){
  let id = localStorage.getItem("deviceId");
  if(!id){ id="dev-"+crypto.randomUUID(); localStorage.setItem("deviceId",id);}
  return id;
}

/* Load Candidates */
onSnapshot(collection(db,"candidates"), snap=>{
  let html="";
  snap.forEach(doc=>{
    const name=doc.data().name;
    html+=`<button class="primary voteBtn" data-name="${name}">Vote ${name}</button><br>`;
  });
  document.getElementById("candidateList").innerHTML=html;

  document.querySelectorAll(".voteBtn").forEach(btn=>{
    btn.onclick=async()=>{
      btn.disabled=true;
      const deviceId=getDeviceId();
      const voted=await getDocs(query(collection(db,"votes"),where("deviceId","==",deviceId)));
      if(!voted.empty){ alert("Already voted."); btn.disabled=false; return;}
      const village=document.getElementById("villageSelect").value;
      if(!village){ alert("Select village."); btn.disabled=false; return;}
      await addDoc(collection(db,"votes"),{candidate:btn.dataset.name,village,deviceId,timestamp:Date.now()});
      btn.classList.add("voted");
      btn.innerText="Vote Submitted ✓";
    }
  });
});

/* Analytics */
let voteChart,pollChart;

onSnapshot(collection(db,"votes"),snap=>{
  const counts={},villages={};
  snap.forEach(doc=>{
    const d=doc.data();
    counts[d.candidate]=(counts[d.candidate]||0)+1;
    villages[d.village]=(villages[d.village]||0)+1;
  });
  document.getElementById("totalVotes").innerText="Total Votes: "+snap.size;
  updateVoteChart(counts);
  updateVillageStats(villages);
});

onSnapshot(collection(db,"polls"),snap=>{
  let yes=0,no=0;
  snap.forEach(doc=>doc.data().answer==="Yes"?yes++:no++);
  document.getElementById("pollStats").innerText="Poll Responses: "+(yes+no);
  document.getElementById("pollResults").innerText=`Yes: ${yes} | No: ${no}`;
  updatePollChart(yes,no);
});

window.castPoll=async(answer)=>{
  const deviceId=getDeviceId();
  const snap=await getDocs(query(collection(db,"polls"),where("deviceId","==",deviceId)));
  if(!snap.empty){alert("Already participated");return;}
  await addDoc(collection(db,"polls"),{answer,deviceId,timestamp:Date.now()});
};

window.addCandidate=async()=>{
  const name=document.getElementById("candidateName").value.trim();
  if(!name)return alert("Enter name");
  await addDoc(collection(db,"candidates"),{name});
  document.getElementById("candidateName").value="";
};

window.login=()=>{
  if(adminEmail.value==="Admin@nginda.com" && adminPassword.value==="31310739"){
    adminPanel.style.display="block";
  } else alert("Invalid Credentials");
};

window.logout=()=>adminPanel.style.display="none";

/* Charts */
function updateVoteChart(data){
  const ctx=document.getElementById("voteChart");
  if(voteChart)voteChart.destroy();
  voteChart=new Chart(ctx,{type:"bar",data:{labels:Object.keys(data),datasets:[{label:"Votes",data:Object.values(data),backgroundColor:"gold"}]}});
}
function updatePollChart(yes,no){
  const ctx=document.getElementById("pollChart");
  if(pollChart)pollChart.destroy();
  pollChart=new Chart(ctx,{type:"pie",data:{labels:["Yes","No"],datasets:[{data:[yes,no],backgroundColor:["gold","#444"]}]}});  
}
function updateVillageStats(data){
  let html="<h4>Village Breakdown</h4>";
  for(let v in data)html+=`${v}: ${data[v]} votes<br>`;
  villageStats.innerHTML=html;
}
</script>

</body>
</html>
